<script>
(async function(){
  // CONFIGURACIÓN
  const username = "argentex2000-byte";
  const repo     = "Argentex";
  const folder   = "fondo"; // Carpeta donde están las FOTOS
  
  // URL de la base de las imágenes
  const imgBaseUrl  = `https://raw.githubusercontent.com/${username}/${repo}/main/${folder}/`;
  
  // URL de tu archivo de datos (Asumiendo que subes datos.json a la carpeta 'fondo' también)
  // Si lo subes a la raíz del repo, quita el "/${folder}" de abajo.
  const dataUrl     = `https://raw.githubusercontent.com/${username}/${repo}/main/${folder}/datos.json`;

  const grid = document.getElementById('grid');

  try {
      // 1) Traer la "Base de Datos" (el JSON)
      const res = await fetch(dataUrl);
      if (!res.ok) throw new Error("No se encontró el archivo datos.json");
      const productos = await res.json();

      // 2) Renderizar cada producto
      productos.forEach(prod => {
        // Construimos la URL completa de la imagen
        const src = imgBaseUrl + prod.archivo;

        // Creamos la tarjeta (Article para mejor semántica)
        const article = document.createElement('article');
        article.className = 'g-item'; 
        
        // Insertamos el HTML con tus campos nuevos
        article.innerHTML = `
          <div class="img-wrapper">
            <img src="${src}" alt="${prod.titulo}" loading="lazy">
          </div>
          <div class="info-content">
            <h3>${prod.titulo}</h3>
            <p class="desc">${prod.descripcion}</p>
            
            <div class="specs">
              <span><strong>Mat:</strong> ${prod.material}</span>
              <span><strong>Col:</strong> ${prod.color}</span>
              <span><strong>Tam:</strong> ${prod.tamano}</span>
            </div>
          </div>
        `;
        
        // Hacemos que al hacer clic en la imagen (wrapper) se abra el lightbox
        const imgDiv = article.querySelector('.img-wrapper');
        imgDiv.addEventListener('click', (e) => { 
            e.stopPropagation(); // Evita clics dobles
            openLightbox(src); 
        });
        
        // Añadimos la tarjeta a la grilla
        grid.appendChild(article);
        
        // Agregamos a la lista del lightbox
        list.push(src);
      });

  } catch (error) {
      console.error("Error:", error);
      grid.innerHTML = `<p style="color:white; text-align:center;">
        Error cargando la galería. Verifica que <b>datos.json</b> esté subido a GitHub.
      </p>`;
  }

  // ===== LÓGICA DEL LIGHTBOX (Igual que antes, solo ajustada) =====
  const list = []; // Se llena arriba en el bucle
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lb-img');
  const btnClose = lb.querySelector('.lb-close');
  const btnPrev  = lb.querySelector('.lb-prev');
  const btnNext  = lb.querySelector('.lb-next');
  let idx = 0;

  function openLightbox(src){
    idx = list.indexOf(src);
    lbImg.src = src;
    lb.classList.add('open');
  }
  function closeLightbox(){ lb.classList.remove('open'); lbImg.src=""; }
  function step(d){ idx=(idx+d+list.length)%list.length; lbImg.src=list[idx]; }

  btnClose.onclick = closeLightbox;
  btnPrev.onclick = ()=>step(-1);
  btnNext.onclick = ()=>step(1);
  lb.onclick = (e)=>{ if(e.target===lb) closeLightbox() };
})();
</script>
